<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Flowchart Reader</title>
  <style type="text/css">
    .end-element { background-color : #FFCCFF; }
  </style>
  <script src="./lib/raphael.min.js"></script>
  <script src="./lib/flowchart.min.js"></script>
  <script>    
    var errorFileNames = [];

    function displayParseErrors() {
      var errorFilesString = errorFileNames.reduce(
        function(acc, cur){
          if (acc !== "") {
            return acc + ", " + cur;
          } else {
            return cur;
          }
        }, "");
      var errorMsg = "Error: the following files could not be uploaded: "

      var msgDisplay = document.getElementById("error_msg");
      msgDisplay.hidden = false;
      msgDisplay.innerHTML = errorMsg + " " + errorFilesString;
     }

     function clearParseErrors() {
       errorFileNames = [];
       var msgDisplay = document.getElementById("error_msg");
       msgDisplay.hidden = true;
       msgDisplay.innerHTML = "";
     }

     function loadFiles() {
       clearParseErrors();
       document.getElementById("canvas").innerHTML = "";
       Array.prototype.forEach.call(document.getElementById("files_input").files, function(file){
         var reader = new FileReader();
             
         reader.onload = function(event){
           try {
             flowchart.parse(event.target.result).drawSVG("canvas");
           } catch (err){
             errorFileNames.push(file.name);
             displayParseErrors();
           }
         };
         try {
           reader.readAsText(file);
         } catch (err){
           errorFileNames.push(file.name);
           displayParseErrors();
         }
       });
     }
  </script>
</head>
<body>
  <h2 id="error_msg" hidden="true"></h2>
  <div style="text-align:center;">
    <input id="files_input" type="file" multiple="multiple" placeholder="Choose a File" onchange="loadFiles()">
  </div>
  <div style="text-align:center;" id="canvas"></div>
</body>
